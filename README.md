<h1>Malware Analysis Lab</h1>

<h2>Description</h2>
a completely isolated network with machines for malware analysis and detection. It's a key part of the infrastructure of any SOC, CERT or CIRT
<br />


<h2>Languages and Utilities Used</h2>

- <b>PowerShell</b> 
- <b>VirtualBox</b>
- <b>Remnux</b>

<h2>Environments Used </h2>

- <b>Windows 10</b> (21H2)

<h2>Program walk-through:</h2>

VirtualBox:
https://www.virtualbox.org/wiki/Downloads

Windows 10 Enterprise:
- Microsoft Evaluation Center: https://info.microsoft.com/ww-landing-windows-10-enterprise.html
- Direct Download: https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise

Remnux:
https://docs.remnux.org/install-distro/get-virtual-appliance

<p align="center">
:Setup Windows 10 With Guest Additions <br/>
<img src="https://i.imgur.com/GT3MCYP.png  height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Create a new Virtual Machine.:  <br/>
<img src=https://imgur.com/E5LeBCj.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Create a new partition.: <br/>
<img src=https://imgur.com/wKCscuk.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
 Choose Domain Join:  <br/>

<br />
<br />
  <br/>
<img src=https://imgur.com/fRH8xGI.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Devices -> Insert Guest Additions CD Image:  <br/>

<br />
<br />
Setup FlareVM

1. **Download and Install Browsers:**
   - Chrome: https://www.google.com/chrome/
   - Firefox: https://www.mozilla.org/en-US/firefox/new/

2. **Optional: Download Windows Terminal:**
   - Open PowerShell as an administrator and run the following commands:

     ```powershell
     wget https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx -usebasicparsing -o VCLibs.appx
     wget https://github.com/microsoft/terminal/releases/download/v1.15.3465.0/Microsoft.WindowsTerminal_Win10_1.15.3465.0_8wekyb3d8bbwe.msixbundle -UseBasicParsing -o winterminal.msixbundle
     ```

   - Add the VCLibs package:

     ```powershell
     Add-AppxPackage [C:\path\to\downloaded\VCLibs.appx]
     ```

   - Install the Windows Terminal MSIX bundle:

     ```powershell
     Add-AppxPackage [C:\path\to\downloaded\winterminal.msixbundle]
     ```

   - (Optional) Pin Windows Terminal to the taskbar.

3. **Disable Proxy Auto-Detect:**
   - In the Windows search bar, search for "proxy settings".
   - Switch the "Automatically detect settings" button off.

4. **Disable Windows Defender:**
   - **Disable Tamper Protection:**
     - Search "Defender", open Defender settings, and set all Defender settings to off.
   - **Disable Windows Defender via Group Policy:**
     - In the Windows Search Bar, search and select "edit group policy".
     - Navigate to: Administrative Templates → Windows Components → Microsoft Defender Antivirus
     - Enable "Turn off Microsoft Defender Antivirus".
   - **Disable Windows Firewall via Group Policy:**
     - Navigate to: Administrative Templates → Network → Network Connections → Windows Defender Firewall
     - For both Domain Profile and Standard Profile, disable "Protect All Network Connections".

5. **Take a Snapshot:**
   - Take a snapshot of your VM in its current state.

6. **Download and Install FlareVM:**
   - In a PowerShell Admin prompt, run:

     ```powershell
     (New-Object net.webclient).DownloadFile('https://raw.githubusercontent.com/mandiant/flarevm/main/install.ps1',"$([Environment]::GetFolderPath('Desktop'))\install.ps1")
     ```

   - Change directories to the Desktop:

     ```powershell
     cd $([Environment]::GetFolderPath('Desktop'))
     ```

   - Unblock the downloaded script:

     ```powershell
     Unblock-File .\install.ps1
     ```

   - Set the execution policy to unrestricted:

     ```powershell
     Set-ExecutionPolicy Unrestricted
     ```

   - Accept the prompt to set the execution policy to unrestricted if one appears.
   - Run the FlareVM installation script:

     ```powershell
     .\install.ps1
     ```

   - Follow the rest of the prompts and continue with the installation.

7. **Take Another Snapshot:**
   - This is the base FlareVM installation.

8. **VirtualBox Network Settings:**
   - Create an isolated host-only adapter network in VirtualBox to allow the Windows 10 machine and Remnux to communicate with each other.

<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
